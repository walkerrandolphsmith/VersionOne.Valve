<!DOCTYPE html>
  <html lang="en">
  <head>
      <title></title>
      <meta name="description" content="VersionOne.Valve documnetation" />
      <meta name="author" content="VersionOne.Valve" />
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="HandheldFriendly" content="True">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="referrer" content="no-referrer-when-downgrade">
      <link rel="icon" type="image/png" href="http://localhost:3000/css/images/profile.png" />
      <link rel="apple-touch-icon" sizes="57x57" href="http://localhost:3000/css/images/apple-icon-57x57.png" />
      <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:3000/css/images/apple-icon-72x72.png" />
      <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:3000/css/images/apple-icon-114x114.png" />
      <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:3000/css/images/apple-icon-144x144.png" />      <link rel="stylesheet" href="http://localhost:3000/css/styles.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" type="text/javascript" />
  </head>
  <body>
    <header class="blog-info fixed hidden">
        <div class="title">
            <a href="http://localhost:3000">VersionOne.Valve</a>
        </div>
        <nav class="main light">
            <ul>
                <li class="nav-home" role="presentation"><a href="http://localhost:3000">Home</a></li>
            </ul>
        </nav>    </header>
    <main class="page-wrapper">    <section class="hero">
        <div class="background"></div>
        <header class="blog-info transparent">
            <div class="title">
                <a href="http://localhost:3000">VersionOne.Valve</a>
            </div>
            <nav class="main light">
                <ul>
                    <li class="nav-home" role="presentation"><a href="http://localhost:3000">Home</a></li>
                </ul>
            </nav>    </header>
        <section class="post-item post-title center wrapper">
            <h1 class="title">VersionOne.Valve</h1>
        </section>
    </section>     <section id="article">
        <article class="post-contents">
        <h1></h1>
        <h2><a name="home" class="anchor" href="#home"></a>Home</h2><div class="code-wrapper"><pre class="language-none line-numbers"><code class="language-none line-numbers">|-- .env                        # env vars used to declare VersionOne instance url
|-- valvefile
|-- bin
|   |--index                    # entry point to running commands
|   |--options                  # define the known command line flags
|   |--commands                 # commands that can be run
|-- package.json
|-- README.md
|-- src
|   |-- common                  # constants and fns used by any feature
|   |-- features                # collection of features
|   |   |-- daag                
|   |   |   |-- utils           # constants and fns used by this feature
|   |   |   |   |-- index.js
|   |   |   |-- index.js        # default valve file that can be run by cli
|   |   |   |-- S1234           # valve files that can be run by cli
|   |   |   |-- S2345           # ...<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><i class="fa fa-copy"></i></div><h2><a name="file-anatomy" class="anchor" href="#file-anatomy"></a>File Anatomy</h2><div class="code-wrapper"><pre class="language-js line-numbers"><code class="language-js line-numbers"><span class="token keyword" >import</span> throttler <span class="token keyword" >from</span> <span class="token string" >'./../../common/throttler'</span><span class="token punctuation" >;</span>
<span class="token keyword" >import</span> times <span class="token keyword" >from</span> <span class="token string" >'./../../common/times'</span><span class="token punctuation" >;</span>
<span class="token keyword" >const</span> Runner <span class="token operator" >=</span> <span class="token function" >require</span><span class="token punctuation" >(</span><span class="token string" >'./../../runner'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

module<span class="token punctuation" >.</span>exports <span class="token operator" >=</span> <span class="token keyword" >class</span> <span class="token class-name" >ValveRunner</span> <span class="token keyword" >extends</span> <span class="token class-name" >Runner</span> <span class="token punctuation" >{</span>
     <span class="token comment" spellcheck="true">/*
     *
     * Options are passed in from the command line.
     * Enrich your feature by providing command line options
     * Example of usage in ./src/features/member/index.js
     *
     */</span>
    <span class="token function" >constructor</span><span class="token punctuation" >(</span>options<span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token keyword" >super</span><span class="token punctuation" >(</span>options<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>

    <span class="token comment" spellcheck="true">/*
     * Command must be marked as async to use await within its scope
     */</span>
    <span class="token keyword" >async</span> <span class="token function" >command</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token comment" spellcheck="true">/*
        *
        * This function must return a Promise!
        *
        */</span>
        <span class="token keyword" >return</span> <span class="token keyword" >new</span> <span class="token class-name" >Promise</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span>resolve<span class="token punctuation" >,</span> reject<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
            <span class="token comment" spellcheck="true">/*
            *
            * Get a reference to the V1 SDK as a user
            *
            */</span>
            <span class="token keyword" >const</span> v1 <span class="token operator" >=</span> <span class="token keyword" >this</span><span class="token punctuation" >.</span><span class="token function" >authenticateAs</span><span class="token punctuation" >(</span><span class="token string" >'admin'</span><span class="token punctuation" >,</span> <span class="token string" >'admin'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

            <span class="token comment" spellcheck="true">/*
            *
            * Visit the V1 SDK docs for more about using the SDK
            *
            *
            */</span>
            <span class="token keyword" >const</span> results <span class="token operator" >=</span> v1<span class="token punctuation" >.</span><span class="token function" >query</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span>
                    <span class="token keyword" >from</span><span class="token punctuation" >:</span> <span class="token string" >'PrimaryWorkitem'</span><span class="token punctuation" >,</span>
                    select<span class="token punctuation" >:</span> <span class="token punctuation" >[</span>
                        <span class="token string" >'Name'</span>
                    <span class="token punctuation" >]</span><span class="token punctuation" >,</span>
                    where<span class="token punctuation" >:</span> <span class="token punctuation" >{</span>
                        ID<span class="token punctuation" >:</span> <span class="token string" >'Story:8546'</span>
                    <span class="token punctuation" >}</span>
                <span class="token punctuation" >}</span><span class="token punctuation" >)</span>
                <span class="token punctuation" >.</span><span class="token function" >then</span><span class="token punctuation" >(</span>response <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
                    <span class="token comment" spellcheck="true">//axios stores the results you want in response.data</span>
                    console<span class="token punctuation" >.</span><span class="token function" >log</span><span class="token punctuation" >(</span>response<span class="token punctuation" >.</span>data<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
                <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token keyword" >catch</span><span class="token punctuation" >(</span><span class="token punctuation" >(</span>err<span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >{</span>
                    <span class="token function" >reject</span><span class="token punctuation" >(</span><span class="token string" >'error talking with V1'</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
                <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>

            <span class="token comment" spellcheck="true">/*
            *
            * Only so many HTTP requests can be handled by IIS at once so throttle them!
            *
            */</span>
            <span class="token keyword" >const</span> promisesInFlight <span class="token operator" >=</span> <span class="token number" >25</span><span class="token punctuation" >;</span>
            <span class="token keyword" >const</span> promises <span class="token operator" >=</span> <span class="token function" >times</span><span class="token punctuation" >(</span><span class="token number" >1000</span><span class="token punctuation" >)</span><span class="token punctuation" >.</span><span class="token function" >map</span><span class="token punctuation" >(</span>i <span class="token operator" >=</span><span class="token operator" >></span> <span class="token punctuation" >(</span><span class="token punctuation" >)</span> <span class="token operator" >=</span><span class="token operator" >></span> Promise<span class="token punctuation" >.</span><span class="token function" >resolve</span><span class="token punctuation" >(</span>i<span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
            <span class="token keyword" >const</span> resolvedValues <span class="token operator" >=</span> <span class="token keyword" >await</span> <span class="token function" >throttler</span><span class="token punctuation" >(</span>promises<span class="token punctuation" >,</span> promisesInFlight<span class="token punctuation" >)</span><span class="token punctuation" >;</span>

            <span class="token function" >resolve</span><span class="token punctuation" >(</span>resolvedValues<span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span><span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><i class="fa fa-copy"></i></div>
        </article>
        <div class="aside-wrapper">
            <aside class="natural">
                  <section id="toc">
                      <header>
                      <h3>In this Article</h3>
                      <i class="fa fa-plus expander"></i>
                      </header>
                      <ul>
                          <li>
                             <a href="/home#home">Home</a>
                          </li>
                          <li>
                             <a href="/home#file-anatomy">File Anatomy</a>
                          </li>
                      </ul>
                  </section>
            </aside>
        </div>
    </section>
    </section>
      </main>
      <footer class="main">
        <section class="made-by">
            <div class="main">Made with <i class="fa fa-heart"></i></div>
        </section>
        <ul class="social">

        </ul>
      </footer>
      <script src="http://localhost:3000/index.js" type="text/javascript"></script>
    </body>
  </html>